(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{141:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/immer-4002b3fd2cfd3aa66c62ecc525663c0d.png"},84:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return c})),a.d(t,"toc",(function(){return l})),a.d(t,"default",(function(){return m}));var r=a(3),n=a(7),i=(a(0),a(98)),o={id:"introduction",title:"Introduction to Immer",sidebar_label:"Introduction",slug:"/"},c={unversionedId:"introduction",id:"introduction",isDocsHomePage:!1,title:"Introduction to Immer",description:"Immer",source:"@site/docs/introduction.md",slug:"/",permalink:"/immer/",editUrl:"https://github.com/immerjs/immer/edit/master/website/docs/introduction.md",version:"current",sidebar_label:"Introduction",sidebar:"Immer",next:{title:"Installation",permalink:"/immer/installation"}},l=[{value:"Immer simplifies handling immutable data structures",id:"immer-simplifies-handling-immutable-data-structures",children:[]},{value:"A quick example for comparison",id:"a-quick-example-for-comparison",children:[]},{value:"How Immer works",id:"how-immer-works",children:[]},{value:"Benefits",id:"benefits",children:[]}],s={toc:l};function m(e){var t=e.components,o=Object(n.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},s,o,{components:t,mdxType:"MDXLayout"}),Object(i.b)("center",null,Object(i.b)("div",{"data-ea-publisher":"immerjs","data-ea-type":"image",class:"horizontal bordered"})),Object(i.b)("img",{src:"/immer/img/immer-logo.svg",height:"200px",align:"right"}),Object(i.b)("h1",{id:"immer"},"Immer"),Object(i.b)("p",null,'Winner of the "Breakthrough of the year" ',Object(i.b)("a",{parentName:"p",href:"https://osawards.com/react/"},"React open source award"),' and "Most impactful contribution" ',Object(i.b)("a",{parentName:"p",href:"https://osawards.com/javascript/"},"JavaScript open source award")," in 2019."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Introduction blogpost: ",Object(i.b)("a",{parentName:"li",href:"https://medium.com/@mweststrate/introducing-immer-immutability-the-easy-way-9d73d8f71cb3"},"Immer: Immutability the easy way")),Object(i.b)("li",{parentName:"ul"},"Short Egghead.io lesson covering the Immer essentials: ",Object(i.b)("a",{parentName:"li",href:"https://egghead.io/lessons/redux-simplify-creating-immutable-data-trees-with-immer"},"Simplify creating immutable data trees with Immer (7m)")),Object(i.b)("li",{parentName:"ul"},"Free in-depth Egghead.io course: ",Object(i.b)("a",{parentName:"li",href:"https://egghead.io/courses/immutable-javascript-data-structures-with-immer"},"Immutable JavaScript Data Structures with Immer (58m)"))),Object(i.b)("hr",null),Object(i.b)("p",null,"Immer (German for: always) is a tiny package that allows you to work with immutable state in a more convenient way."),Object(i.b)("h3",{id:"immer-simplifies-handling-immutable-data-structures"},"Immer simplifies handling immutable data structures"),Object(i.b)("p",null,"Immer can be used in any context in which immutable data structures need to be used. For example in combination with React state, React or Redux reducers, or configuration management. Immutable data structures allow for (efficient) change detection: if the reference to an object didn't change, the object itself did not change. In addition, it makes cloning relatively cheap: Unchanged parts of a data tree don't need to be copied and are shared in memory with older versions of the same state."),Object(i.b)("p",null,"Generally speaking, these benefits can be achieved by making sure you never change any property of an object, array or map, but by always creating an altered copy instead. In practice this can result in code that is quite cumbersome to write, and it is easy to accidentally violate those constraints. Immer will help you to follow the immutable data paradigm by addressing these pain points:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Immer will detect accidental mutations and throw an error."),Object(i.b)("li",{parentName:"ol"},"Immer will remove the need for the typical boilerplate code that is needed when creating deep updates to immutable objects: Without Immer, object copies need to be made by hand at every level. Typically by using a lot of ",Object(i.b)("inlineCode",{parentName:"li"},"...")," spread operations. When using Immer, changes are made to a ",Object(i.b)("inlineCode",{parentName:"li"},"draft")," object, that records the changes and takes care of creating the necessary copies, without ever affecting the original object."),Object(i.b)("li",{parentName:"ol"},"When using Immer, you don't need to learn dedicated APIs or data structures to benefit from the paradigm. With Immer you'll use plain JavaScript data structures, and use the well know mutable JavaScript APIs, but safely.")),Object(i.b)("h3",{id:"a-quick-example-for-comparison"},"A quick example for comparison"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'const baseState = [\n    {\n        title: "Learn TypeScript",\n        done: true\n    },\n    {\n        title: "Try Immer",\n        done: false\n    }\n]\n')),Object(i.b)("p",null,"Imagine we have the above base state, and we'll need to update the second todo, and add a third one. However, we don't want to mutate the original ",Object(i.b)("inlineCode",{parentName:"p"},"baseState"),", and we want to avoid deep cloning as well (to preserve the first todo)."),Object(i.b)("h4",{id:"without-immer"},"Without Immer"),Object(i.b)("p",null,"Without Immer, we'll have to carefully shallow copy every level of the state structure that is affected by our change:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'const nextState = baseState.slice() // shallow clone the array\nnextState[1] = {\n    // replace element 1...\n    ...nextState[1], // with a shallow clone of element 1\n    done: true // ...combined with the desired update\n}\n// since nextState was freshly cloned, using push is safe here,\n// but doing the same thing at any arbitrary time in the future would\n// violate the immutability principles and introduce a bug!\nnextState.push({title: "Tweet about it"})\n')),Object(i.b)("h4",{id:"with-immer"},"With Immer"),Object(i.b)("p",null,"With Immer, this process is more straightforward. We can leverage the ",Object(i.b)("inlineCode",{parentName:"p"},"produce")," function, which takes as first argument the state we want to start from, and as second argument we pass a function, called the ",Object(i.b)("em",{parentName:"p"},"recipe"),", that is passed a ",Object(i.b)("inlineCode",{parentName:"p"},"draft")," to which we can apply straightforward mutations. Those mutations are recorded and used to produce the next state once the recipe is done. ",Object(i.b)("inlineCode",{parentName:"p"},"produce")," will take care of all the necessary copying, and protect against future accidental modifications as well by freezing the data."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'import produce from "immer"\n\nconst nextState = produce(baseState, draft => {\n    draft[1].done = true\n    draft.push({title: "Tweet about it"})\n})\n')),Object(i.b)("p",null,"Looking for Immer in combination with React? Feel free to skip ahead to the ",Object(i.b)("a",{parentName:"p",href:"example-setstate"},"React + Immer")," page."),Object(i.b)("h3",{id:"how-immer-works"},"How Immer works"),Object(i.b)("p",null,"The basic idea is that with Immer you will apply all your changes to a temporary ",Object(i.b)("em",{parentName:"p"},"draft"),", which is a proxy of the ",Object(i.b)("em",{parentName:"p"},"currentState"),". Once all your mutations are completed, Immer will produce the ",Object(i.b)("em",{parentName:"p"},"nextState")," based on the mutations to the draft state. This means that you can interact with your data by simply modifying it while keeping all the benefits of immutable data."),Object(i.b)("p",null,Object(i.b)("img",{alt:"immer-hd.png",src:a(141).default})),Object(i.b)("p",null,"Using Immer is like having a personal assistant. The assistant takes a letter (the current state) and gives you a copy (draft) to jot changes onto. Once you are done, the assistant will take your draft and produce the real immutable, final letter for you (the next state)."),Object(i.b)("p",null,"Head to the ",Object(i.b)("a",{parentName:"p",href:"/immer/produce"},"next section")," to further dive into ",Object(i.b)("inlineCode",{parentName:"p"},"produce"),"."),Object(i.b)("h2",{id:"benefits"},"Benefits"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'Follow the immutable data paradigm, while using normal JavaScript objects, arrays, Sets and Maps. No new APIs or "mutation patterns" to learn!'),Object(i.b)("li",{parentName:"ul"},"Strongly typed, no string based paths selectors etc."),Object(i.b)("li",{parentName:"ul"},"Structural sharing out of the box"),Object(i.b)("li",{parentName:"ul"},"Object freezing out of the box"),Object(i.b)("li",{parentName:"ul"},"Deep updates are a breeze"),Object(i.b)("li",{parentName:"ul"},"Boilerplate reduction. Less noise, more concise code."),Object(i.b)("li",{parentName:"ul"},"First class support for JSON patches"),Object(i.b)("li",{parentName:"ul"},"Small: 3KB gzipped")))}m.isMDXComponent=!0},98:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return b}));var r=a(0),n=a.n(r);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=n.a.createContext({}),m=function(e){var t=n.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},u=function(e){var t=m(e.components);return n.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},p=n.a.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=m(a),p=r,b=u["".concat(o,".").concat(p)]||u[p]||d[p]||i;return a?n.a.createElement(b,c(c({ref:t},s),{},{components:a})):n.a.createElement(b,c({ref:t},s))}));function b(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=p;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,o[1]=c;for(var s=2;s<i;s++)o[s]=a[s];return n.a.createElement.apply(null,o)}return n.a.createElement.apply(null,a)}p.displayName="MDXCreateElement"}}]);